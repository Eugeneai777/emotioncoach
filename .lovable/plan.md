
## 财富教练行动推荐定制化优化

### 问题分析

当前系统提示词（第596-660行）虽然包含了个性化推荐规则（基于人物关系、情绪类型、信念类型、四穷类型），但实际效果仍然偏模板化。原因：

1. **扩展选项库过于详细**（第660-700行列出了40+通用选项），AI 倾向于直接从中复制粘贴
2. **3个选项固定为"语言给予/行动给予/祝福给予"分类**，导致推荐总是按套路出牌
3. **缺少强制引用对话内容的约束**，AI 可以生成与对话无关的建议

### 修复方案

修改 `supabase/functions/wealth_coach_4_questions-coach/index.ts` 中第6轮给予行动的提示词（约第596-700行），核心改动：

**1. 删除通用选项库**
- 移除第660-700行的"扩展选项库"（语言给予、行动给予、祝福给予、创意给予的40+模板选项）
- 避免 AI 偷懒直接复制通用选项

**2. 强制基于对话生成行动**
- 每个行动必须明确引用用户在对话中提到的具体人物、场景或事件
- 格式要求：每个行动必须包含"因为你今天提到了[具体内容]"的关联说明
- 行动必须具体到可立即执行（包含时间、对象、具体做什么）

**3. 改变3选项结构**
- 从固定分类（语言/行动/祝福）改为按对话内容生成的3个递进行动：
  - 选项1：最小行动（5分钟内可完成，与对话中最触动的点相关）
  - 选项2：深度行动（今天内可完成，针对核心卡点的练习）
  - 选项3：持续行动（本周可坚持，与信念转化直接相关）

### 技术细节

修改边缘函数提示词，将第596-700行替换为：

```
第6轮：给予行动 - 深度定制

【最高优先级规则】
行动推荐必须100%来自本次对话内容，严禁使用通用模板！

【生成步骤】
1. 回顾用户在本次对话中提到的：
   - 具体的人（谁？）
   - 具体的场景（什么事？）
   - 核心情绪（什么感受？）
   - 新旧信念转换（从什么到什么？）

2. 基于以上内容生成3个递进行动：

格式：
"太好了，{用户名}！

今天你看见了很多，现在让我们把觉察变成行动。

基于你刚才分享的经历，我为你定制了3个行动：

1️⃣ 🌱 **现在就做**（5分钟）
[必须直接引用对话中的具体人物或场景]
例：你刚提到和{某人}的那件事让你感到{情绪}，
现在就给TA发一条消息：'{具体内容}'

2️⃣ 🔥 **今日挑战**
[针对用户的核心卡点设计的练习]
例：你发现自己有'{旧信念}'的模式，
今天试试：当这个念头出现时，{具体替代行为}

3️⃣ 🌊 **本周练习**
[与信念转化直接相关的持续行动]
例：为了强化'{新信念}'，这周每天{具体行动}

你想选哪个？也可以告诉我你自己的想法～"

【禁止事项】
- 禁止推荐"给3个人点赞"、"默默祝福"等无具体对象的行动
- 禁止推荐与对话内容无关的通用行动
- 每个行动必须让用户一看就知道"这是为我量身定制的"
```

### 涉及文件
- `supabase/functions/wealth_coach_4_questions-coach/index.ts`（提示词修改，约第596-700行）
