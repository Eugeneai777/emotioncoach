

# AI 主图风格统一 + 组合包 AI 建议优化

## 问题分析

1. **主图风格不统一**：当前 AI 生成主图的 Prompt 过于笼统（"现代简约、健康温暖"），没有参照网站真实的商城卡片风格，导致生成的图片与有劲 AI 品牌视觉不一致。
2. **AI 建议位置不明显**：组合包创建流程中缺少"AI 推荐组合"功能，用户需要自己手动选产品。

## 改动方案

### 1. 优化 AI 主图生成 Prompt（边缘函数）

修改 `supabase/functions/ai-generate-bundle/index.ts` 中的图片生成 Prompt：

- 指定 **1:1 正方形** 比例（与商城卡片 `aspect-square` 一致）
- 加入有劲 AI 品牌设计规范：圆角卡片感、温暖渐变色系（teal/emerald 为主色）、干净留白
- 强调纯文字排版 + 品牌色，不使用真实照片或杂乱插图
- 要求底部留出放产品名称和价格的空间（因为卡片 UI 会在图片下方叠加文字）
- 使用更高质量模型 `google/gemini-3-pro-image-preview` 替代 flash 版

### 2. 新增"AI 推荐组合"功能

在组合包创建 Dialog 中增加一个"AI 推荐"按钮：

- 用户输入目标场景或人群关键词（如"职场压力"、"情绪管理"、"身心健康"）
- 调用边缘函数新增 `type: "suggest_bundle"` 模式
- AI 根据关键词从可选产品列表中推荐 3-5 个产品组合
- 用户可一键采纳推荐，自动填充产品选择

### 3. 文件改动清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `supabase/functions/ai-generate-bundle/index.ts` | 修改 | 优化图片 Prompt 匹配品牌风格；新增 suggest_bundle 模式 |
| `src/components/admin/industry-partners/PartnerProductBundles.tsx` | 修改 | 创建 Dialog 中增加"AI 推荐组合"按钮和交互逻辑 |

### 4. 技术细节

**优化后的图片 Prompt 要点：**
- 1:1 正方形（1080x1080px），适配商城 `aspect-square` 布局
- 品牌色系：teal/emerald 渐变为主，搭配温暖的米白/浅金
- 纯色或柔和渐变背景，中央放组合包核心关键词的艺术字
- 整体风格：圆润、温暖、专业、简约，符合有劲 AI 健康生活馆定位
- 不包含真实产品照片，而是用抽象的色块和文字排版

**AI 推荐组合流程：**
- 前端传入：用户输入的场景关键词 + 全部可选产品列表（名称+价格+描述）
- 边缘函数用 tool calling 返回：推荐的产品 key/id 列表 + 推荐理由
- 前端自动勾选推荐的产品并填入组合包名称建议

