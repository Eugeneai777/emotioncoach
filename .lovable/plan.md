
# 手机号替代邮箱注册实施计划

## 概述

将邮箱注册完全替换为手机号+密码注册，用户无需记住邮箱地址，使用更符合中国用户习惯的手机号作为账号标识。

---

## 技术方案

```text
用户输入                    系统处理                       数据库存储
┌────────────────┐      ┌────────────────────┐      ┌─────────────────────┐
│ +86 13812345678│      │ 转换为占位邮箱:     │      │ auth.users:         │
│ 密码: xxxxxx   │ ──▶  │ phone_8613812345678│ ──▶  │   email: phone_xxx  │
│ 昵称: 小明     │      │   @youjin.app      │      │     @youjin.app     │
└────────────────┘      └────────────────────┘      ├─────────────────────┤
                                                    │ profiles:           │
                                                    │   phone: 13812345678│
                                                    │   phone_country_code│
                                                    │     : +86           │
                                                    │   auth_provider:    │
                                                    │     phone           │
                                                    └─────────────────────┘
```

**核心原理**：利用 Supabase Auth 的邮箱字段存储占位邮箱，实际手机号保存在 profiles 表中。

---

## 实施步骤

### 第一步：修改 Auth.tsx 主认证页面

**改动内容**：
1. 将 `email` 状态替换为 `phone` + `countryCode` 状态
2. 用户界面从邮箱输入改为手机号输入（含国家区号选择）
3. 注册/登录时将手机号转换为占位邮箱格式
4. 成功后更新 profiles 表写入真实手机号
5. 文案调整：邮箱 → 手机号

**占位邮箱格式**：
```text
phone_{区号去+}{手机号}@youjin.app

示例：+86 13812345678 → phone_8613812345678@youjin.app
```

### 第二步：修改 QuickRegisterStep.tsx 快捷注册

**改动内容**：
1. 将"邮箱注册"Tab 改为"手机号注册"
2. 将邮箱输入字段替换为手机号+区号选择
3. 将"已有账号"登录中的邮箱改为手机号
4. 复用现有的 `countryCodes` 列表（已在文件中定义）
5. 修改 `handleEmailRegister` 和 `handleEmailLogin` 函数，改为手机号逻辑

### 第三步：辅助函数

**新增工具函数**（在两个文件中复用）：
```typescript
// 生成占位邮箱
function generatePhoneEmail(countryCode: string, phone: string): string {
  const cleanCode = countryCode.replace('+', '');
  return `phone_${cleanCode}${phone}@youjin.app`;
}

// 验证手机号格式
function isValidPhone(phone: string): boolean {
  return /^\d{5,15}$/.test(phone);
}
```

---

## 文件清单

| 操作 | 文件路径 | 改动说明 |
|------|----------|----------|
| 修改 | `src/pages/Auth.tsx` | 邮箱 → 手机号注册/登录 |
| 修改 | `src/components/onboarding/QuickRegisterStep.tsx` | 邮箱 → 手机号注册/登录 |

---

## 用户界面变化

### Auth.tsx 页面

**改动前**：
```text
┌──────────────────────────────────┐
│      情绪梳理教练                 │
│  ┌─────────────────────────────┐ │
│  │  邮箱: your@email.com       │ │
│  └─────────────────────────────┘ │
│  ┌─────────────────────────────┐ │
│  │  密码: ********             │ │
│  └─────────────────────────────┘ │
│  [       登录 / 注册       ]     │
└──────────────────────────────────┘
```

**改动后**：
```text
┌──────────────────────────────────┐
│      情绪梳理教练                 │
│  ┌───────┐ ┌───────────────────┐ │
│  │ +86 ▼ │ │ 13812345678       │ │
│  └───────┘ └───────────────────┘ │
│  ┌─────────────────────────────┐ │
│  │  密码: ********             │ │
│  └─────────────────────────────┘ │
│  [       登录 / 注册       ]     │
└──────────────────────────────────┘
```

### QuickRegisterStep.tsx

**Tab 文案变化**：
- "邮箱注册" → "手机号注册"
- 输入字段同步变化

---

## 安全与兼容性

| 项目 | 措施 |
|------|------|
| 手机号格式验证 | 前端正则校验 `/^\d{5,15}$/` |
| 密码要求 | 最少6位，与原邮箱注册一致 |
| 唯一性约束 | 占位邮箱格式保证唯一性 |
| 数据存储 | 真实手机号存 profiles 表 |
| 现有用户 | 邮箱用户仍可正常登录（需手动输入邮箱格式） |
| 微信注册 | 不受影响，仍使用 wx_xxx 格式 |

---

## 错误处理

| 场景 | 提示信息 |
|------|----------|
| 手机号已注册 | "该手机号已注册，请直接登录" |
| 密码错误 | "手机号或密码错误" |
| 格式错误 | "请输入有效的手机号码" |
| 密码不一致 | "两次密码输入不一致" |

---

## 技术细节

### 注册流程

```text
1. 用户输入：+86 13812345678 + 密码
2. 生成占位邮箱：phone_8613812345678@youjin.app
3. 调用 supabase.auth.signUp({ email: 占位邮箱, password })
4. 更新 profiles：
   - phone: "13812345678"
   - phone_country_code: "+86"
   - auth_provider: "phone"
   - display_name: 用户输入的昵称
5. 注册成功，自动登录
```

### 登录流程

```text
1. 用户输入：+86 13812345678 + 密码
2. 生成相同格式的占位邮箱
3. 调用 supabase.auth.signInWithPassword({ email: 占位邮箱, password })
4. 登录成功
```

---

## 预期效果

- 用户使用手机号+密码注册/登录
- 无需记住邮箱地址
- 符合中国用户习惯
- 与微信登录并行支持
- 现有邮箱用户仍可登录（输入完整邮箱）
