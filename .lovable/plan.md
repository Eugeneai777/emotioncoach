

# 为老用户添加邮箱登录入口

## 概述

在手机号登录界面添加一个"使用邮箱登录"的入口，让之前用邮箱注册的用户可以继续正常登录。

---

## 技术方案

```text
┌──────────────────────────────────┐
│      情绪梳理教练                 │
│                                  │
│  ┌───────┐ ┌───────────────────┐ │
│  │ +86 ▼ │ │ 13812345678       │ │  ← 默认手机号登录
│  └───────┘ └───────────────────┘ │
│  ┌─────────────────────────────┐ │
│  │  密码: ********             │ │
│  └─────────────────────────────┘ │
│  [       登录 / 注册       ]     │
│                                  │
│  📧 之前用邮箱注册？点击这里登录  │  ← 新增入口
│                                  │
│         ── 或 ──                 │
│  [ 使用微信登录/注册 ]            │
└──────────────────────────────────┘
```

---

## 实施步骤

### 第一步：添加认证模式状态

**修改 Auth.tsx**：

新增状态控制当前是手机号模式还是邮箱模式：
```typescript
const [authMode, setAuthMode] = useState<'phone' | 'email'>('phone');
const [email, setEmail] = useState("");  // 恢复邮箱状态
```

---

### 第二步：修改表单渲染逻辑

根据 `authMode` 切换显示不同的输入表单：

**手机号模式**（默认）：
- 国家区号选择 + 手机号输入
- 密码输入

**邮箱模式**：
- 邮箱输入框
- 密码输入
- 仅支持登录（不显示注册相关字段）

---

### 第三步：修改认证处理逻辑

**handleAuth 函数更新**：

```text
if (authMode === 'phone') {
  // 使用占位邮箱登录/注册（现有逻辑）
  const placeholderEmail = generatePhoneEmail(countryCode, phone);
  ...
} else {
  // 直接使用邮箱登录
  await supabase.auth.signInWithPassword({
    email: email,
    password: password,
  });
}
```

---

### 第四步：添加切换入口

在登录按钮下方添加切换链接：

**手机号模式时显示**：
> "之前用邮箱注册？点击这里登录"

**邮箱模式时显示**：
> "使用手机号登录"

---

## 文件清单

| 操作 | 文件路径 | 改动说明 |
|------|----------|----------|
| 修改 | `src/pages/Auth.tsx` | 添加邮箱/手机号模式切换 |

---

## 用户体验

| 用户类型 | 操作流程 |
|----------|----------|
| 新用户 | 默认使用手机号注册，无感知 |
| 老邮箱用户 | 点击"邮箱登录"入口 → 输入邮箱密码 → 登录成功 |
| 手机号用户 | 默认登录方式，无影响 |

---

## 界面文案

- 邮箱模式标题："使用邮箱登录"
- 切换提示："之前用邮箱注册？点击这里登录"
- 返回提示："使用手机号登录"

