
# è§‰é†’ç®€æŠ¥åˆ†ç±»é‡æ„ï¼šè®­ç»ƒè¥ / æ–‡å­—æ•™ç»ƒ / è¯­éŸ³æ•™ç»ƒ

## å½“å‰é—®é¢˜

è§‰é†’ç®€æŠ¥é¡µé¢å°†æ‰€æœ‰å†…å®¹æ··åˆæ˜¾ç¤ºåœ¨ä¸€ä¸ªæ—¶é—´çº¿é‡Œï¼Œç”¨æˆ·æ— æ³•åŒºåˆ†ï¼š
- è®­ç»ƒè¥æ‰“å¡ï¼ˆ7å¤©ä¸€è½®ï¼‰
- æ–‡å­—æ•™ç»ƒæ¢³ç†ï¼ˆ4é—®æ·±åº¦å¯¹è¯ï¼‰
- è¯­éŸ³æ•™ç»ƒé€šè¯ï¼ˆä¸åº”è®¡å…¥è§‰é†’åˆ†ï¼‰

## æ•°æ®å±‚åˆ†æï¼ˆå·²ç¡®è®¤ï¼‰

é€šè¿‡æ•°æ®åº“æŸ¥è¯¢ç¡®è®¤å½“å‰å®é™…æ•°æ®åˆ†å¸ƒï¼š

```text
camp_id=null, session_id=null  â†’ 12æ¡ï¼ˆæ–‡å­—æ•™ç»ƒç®€æŠ¥æ¥æºçš„æ—¥è®°ï¼‰
camp_id=null, session_id=æœ‰å€¼  â†’  1æ¡ï¼ˆè¯­éŸ³æ•™ç»ƒ â†’ journal entryï¼‰
camp_id=æœ‰å€¼, session_id=null  â†’ 21æ¡ï¼ˆè®­ç»ƒè¥æ‰“å¡ï¼‰
```

ä¸‰ç±»æ¥æºè¯†åˆ«è§„åˆ™ï¼ˆä»…é ç°æœ‰å­—æ®µï¼Œæ— éœ€æ”¹è¡¨ï¼‰ï¼š

| åˆ†ç±» | æ¥æºè¡¨ | è¯†åˆ«æ¡ä»¶ |
|------|--------|----------|
| è®­ç»ƒè¥ | `wealth_journal_entries` | `camp_id IS NOT NULL` + `session_id IS NULL` |
| æ–‡å­—æ•™ç»ƒ | `wealth_coach_4_questions_briefings` | ç‹¬ç«‹è¡¨ï¼Œæ‰€æœ‰è®°å½• |
| è¯­éŸ³æ•™ç»ƒ | `wealth_journal_entries` | `session_id IS NOT NULL` |

## è§‰é†’åˆ†è®¡ç®—è§„åˆ™å˜æ›´

è¯­éŸ³æ•™ç»ƒå¯¹è¯ï¼ˆ`session_id IS NOT NULL`ï¼‰**ä¸è®¡å…¥è§‰é†’åˆ†**ã€‚

- ç°æœ‰ `useEnsureAwakeningProgress.ts` ä¸­ç¬¬ 112-131 è¡ŒæŸ¥è¯¢ `wealth_journal_entries` æ¥è®¡ç®—å½“å‰è§‰é†’æŒ‡æ•°æ—¶ï¼Œéœ€è¦è¿‡æ»¤æ‰ `session_id IS NOT NULL` çš„è®°å½•
- ç°æœ‰ `useWealthJournalEntries.ts` çš„ `awakeningIndex` è®¡ç®—åŒæ ·éœ€è¦è¿‡æ»¤è¯­éŸ³æ¡ç›®
- æ–‡å­—æ•™ç»ƒç®€æŠ¥ï¼ˆ`wealth_coach_4_questions_briefings`ï¼‰ç›®å‰**ä¸å‚ä¸è§‰é†’åˆ†è®¡ç®—**ï¼Œç»´æŒç°çŠ¶ä¸å˜ï¼ˆè§‰é†’åˆ†ä»…ç”±è®­ç»ƒè¥æ‰“å¡æ¡ç›®é©±åŠ¨ï¼‰

## è®­ç»ƒè¥è½®æ¬¡æ˜¾ç¤º

è®­ç»ƒè¥æ¯7å¤©ä¸ºä¸€è½®ã€‚`useUserCampMode` å·²è®¡ç®— `cycleRound` å’Œ `cycleDayInRound`ï¼Œä½†è§‰é†’ç®€æŠ¥é¡µé¢æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªé€»è¾‘æ¥åˆ†ç»„æ˜¾ç¤ºã€‚

æ–¹æ¡ˆï¼šæŒ‰ `day_number` åˆ†è½®ï¼š
- ç¬¬1è½®ï¼šDay 1â€“7
- ç¬¬2è½®ï¼šDay 8â€“14ï¼ˆæ˜¾ç¤ºä¸º"ç¬¬äºŒè½® ç¬¬1å¤©"ï¼‰
- ç¬¬3è½®ï¼šDay 15â€“21

è®¡ç®—å…¬å¼ï¼š
```typescript
const round = Math.ceil(entry.day_number / 7); // ç¬¬å‡ è½®
const dayInRound = ((entry.day_number - 1) % 7) + 1; // æœ¬è½®ç¬¬å‡ å¤©
```

## UI é‡æ„æ–¹æ¡ˆ

å°†è§‰é†’ç®€æŠ¥å†…å®¹åŒºæ›¿æ¢ä¸ºä¸‰ä¸ªå­ Tabï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           è§‰é†’ç®€æŠ¥                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  [ è®­ç»ƒè¥ ]  [ æ–‡å­—æ•™ç»ƒ ]  [ è¯­éŸ³æ•™ç»ƒ ]   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                          â•‘
â•‘  è®­ç»ƒè¥ Tab:                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ğŸ•ï¸ ç¬¬ä¸€è½®                        â”‚   â•‘
â•‘  â”‚  Day 1 â†’ Day 7                   â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚  ç¬¬7å¤© Â· 3æœˆ18æ—¥  â­â­â­â­        â”‚   â•‘
â•‘  â”‚  ç¬¬6å¤© Â· 3æœˆ17æ—¥  â­â­â­          â”‚   â•‘
â•‘  â”‚  ...                             â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ğŸ•ï¸ ç¬¬äºŒè½®ï¼ˆç¬¬1å¤©å®Œæˆï¼‰            â”‚   â•‘
â•‘  â”‚  Day 8 â†’ Day 14                  â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                          â•‘
â•‘  æ–‡å­—æ•™ç»ƒ Tab:                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ğŸ’¬ æ•™ç»ƒå¯¹è¯  3æœˆ15æ—¥ 14:30        â”‚   â•‘
â•‘  â”‚ ğŸ¯ è¡Œä¸ºæ´å¯Ÿï¼š...                 â”‚   â•‘
â•‘  â”‚ ğŸ’› æƒ…ç»ªæ´å¯Ÿï¼š...                 â”‚   â•‘
â•‘  â”‚ ğŸ’¡ ä¿¡å¿µæ´å¯Ÿï¼š...                 â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                          â•‘
â•‘  è¯­éŸ³æ•™ç»ƒ Tab:                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ğŸ™ï¸ è¯­éŸ³æ¢³ç†  3æœˆ14æ—¥ 20:15       â”‚   â•‘
â•‘  â”‚ æš‚æ— è¯„åˆ†  (ä¸è®¡å…¥è§‰é†’æŒ‡æ•°)        â”‚   â•‘
â•‘  â”‚ ğŸ§  ä¿¡å¿µï¼š...                     â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## æŠ€æœ¯å®ç°æ¸…å•

### æ–‡ä»¶å˜æ›´

| æ–‡ä»¶ | æ“ä½œ | å†…å®¹ |
|------|------|------|
| `src/pages/WealthCampCheckIn.tsx` | ä¿®æ”¹ | ç®€æŠ¥ Tab å†…å®¹æ”¹ä¸ºä¸‰å­ Tabï¼›è°ƒæ•´ `mergedBriefings` åˆ†ä¸‰ç±» |
| `src/hooks/useEnsureAwakeningProgress.ts` | ä¿®æ”¹ | è¿‡æ»¤è¯­éŸ³æ¡ç›®ï¼ˆ`session_id IS NOT NULL`ï¼‰ä¸å‚ä¸è§‰é†’åˆ†è®¡ç®— |
| `src/hooks/useWealthJournalEntries.ts` | ä¿®æ”¹ | è¿‡æ»¤è¯­éŸ³æ¡ç›®ä¸å‚ä¸ `awakeningIndex` è®¡ç®— |

### WealthCampCheckIn.tsx å…³é”®æ”¹åŠ¨

**æ•°æ®åˆ†å±‚ï¼š**
```typescript
// ä¸‰ç±»åˆ†å¼€
const campEntries = allJournalEntries.filter(
  e => e.camp_id && !e.session_id // è®­ç»ƒè¥æ‰“å¡
);
const voiceEntries = allJournalEntries.filter(
  e => !!e.session_id // è¯­éŸ³æ•™ç»ƒ
);
// wealthCoachBriefings â†’ æ–‡å­—æ•™ç»ƒï¼ˆå·²æœ‰ï¼‰

// è®­ç»ƒè¥æŒ‰è½®æ¬¡åˆ†ç»„
const campRounds = campEntries.reduce((acc, entry) => {
  const round = Math.ceil(entry.day_number / 7);
  if (!acc[round]) acc[round] = [];
  acc[round].push(entry);
  return acc;
}, {} as Record<number, typeof campEntries>);
```

**ä¸‰å­ Tab æ¸²æŸ“ï¼š**
```tsx
<Tabs defaultValue="camp">
  <TabsList className="grid grid-cols-3">
    <TabsTrigger value="camp">
      ğŸ•ï¸ è®­ç»ƒè¥
      {campEntries.length > 0 && <Badge>{campEntries.length}</Badge>}
    </TabsTrigger>
    <TabsTrigger value="text">
      ğŸ’¬ æ–‡å­—æ•™ç»ƒ
      {wealthCoachBriefings.length > 0 && <Badge>{wealthCoachBriefings.length}</Badge>}
    </TabsTrigger>
    <TabsTrigger value="voice">
      ğŸ™ï¸ è¯­éŸ³æ•™ç»ƒ
      {voiceEntries.length > 0 && <Badge>{voiceEntries.length}</Badge>}
    </TabsTrigger>
  </TabsList>

  {/* è®­ç»ƒè¥ Tabï¼šæŒ‰è½®æ¬¡åˆ†ç»„ */}
  <TabsContent value="camp">
    {Object.entries(campRounds).reverse().map(([round, entries]) => (
      <div key={round}>
        <div className="è½®æ¬¡æ ‡é¢˜">
          ğŸ•ï¸ ç¬¬{roundNames[round]}è½®  Day {(round-1)*7+1}â€“{round*7}
        </div>
        {entries
          .sort((a, b) => b.day_number - a.day_number)
          .map(entry => (
            <WealthJournalCard
              key={entry.id}
              entry={entry}
              dayLabel={`ç¬¬ ${((entry.day_number - 1) % 7) + 1} å¤©`}
              roundLabel={round > 1 ? `ç¬¬${roundNames[round]}è½®` : undefined}
            />
          ))
        }
      </div>
    ))}
  </TabsContent>

  {/* æ–‡å­—æ•™ç»ƒ Tabï¼šç°æœ‰ coach_briefing æ¸²æŸ“é€»è¾‘ */}
  <TabsContent value="text">
    {wealthCoachBriefings æ¸²æŸ“...}
  </TabsContent>

  {/* è¯­éŸ³æ•™ç»ƒ Tabï¼šå¸¦"ä¸è®¡å…¥è§‰é†’æŒ‡æ•°"æç¤º */}
  <TabsContent value="voice">
    {voiceEntries æ¸²æŸ“ï¼Œå¸¦ä¸è®¡å…¥è¯´æ˜...}
  </TabsContent>
</Tabs>
```

### useEnsureAwakeningProgress.ts å…³é”®æ”¹åŠ¨

åœ¨ç¬¬ 112 è¡ŒæŸ¥è¯¢æ—¶åŠ è¿‡æ»¤æ¡ä»¶ï¼š
```typescript
const { data: journalEntries } = await supabase
  .from('wealth_journal_entries')
  .select('behavior_score, emotion_score, belief_score, session_id')
  .eq('user_id', user.id)
  .is('session_id', null)  // â† æ–°å¢ï¼šæ’é™¤è¯­éŸ³æ¡ç›®
  .order('day_number', { ascending: false });
```

### useWealthJournalEntries.ts å…³é”®æ”¹åŠ¨

åœ¨ `awakeningIndex` è®¡ç®—çš„ `useMemo` ä¸­è¿‡æ»¤æ‰è¯­éŸ³æ¡ç›®ï¼š
```typescript
const { awakeningIndex, peakIndex, currentAvg } = useMemo(() => {
  if (!entries || entries.length === 0) return { ... };
  
  // è¿‡æ»¤æ‰è¯­éŸ³æ¡ç›®
  const scorableEntries = entries.filter(e => !e.session_id);
  
  const dailyScores = scorableEntries
    .filter(e => (e.behavior_score || 0) > 0 || ...)
    .map(e => { ... });
  ...
}, [entries]);
```

## ä¿®æ”¹èŒƒå›´

- **3ä¸ªæ–‡ä»¶**ï¼Œæ— éœ€æ•°æ®åº“å˜æ›´ï¼Œæ— éœ€æ–°å»ºç»„ä»¶
- åˆ©ç”¨ç°æœ‰ `WealthJournalCard` æ˜¾ç¤ºè®­ç»ƒè¥å’Œè¯­éŸ³æ¡ç›®
- è®­ç»ƒè¥è½®æ¬¡åˆ†ç»„é€»è¾‘å®Œå…¨åœ¨å‰ç«¯åŸºäº `day_number` è®¡ç®—
- è§‰é†’åˆ†è¿‡æ»¤æ˜¯è½»é‡ SQL æ¡ä»¶è¡¥å……ï¼ˆ`.is('session_id', null)`ï¼‰

## æ•ˆæœ

ç”¨æˆ·è¿›å…¥"è§‰é†’ç®€æŠ¥"åï¼š
1. **è®­ç»ƒè¥ Tab**ï¼šçœ‹åˆ°æŒ‰è½®æ¬¡ï¼ˆç¬¬ä¸€è½®Day1-7ã€ç¬¬äºŒè½®Day1-7...ï¼‰åˆ†ç»„çš„æ‰“å¡å†å²ï¼Œæ¸…æ™°ä½“ç°æˆé•¿è½¨è¿¹
2. **æ–‡å­—æ•™ç»ƒ Tab**ï¼šçœ‹åˆ°æ·±åº¦æ¢³ç†çš„4é—®ç®€æŠ¥ï¼Œæ¯æ¡æ˜¾ç¤ºè¡Œä¸º/æƒ…ç»ª/ä¿¡å¿µæ´å¯Ÿ
3. **è¯­éŸ³æ•™ç»ƒ Tab**ï¼šçœ‹åˆ°è¯­éŸ³é€šè¯è®°å½•ï¼Œé…æœ‰"ğŸ”‡ ä¸è®¡å…¥è§‰é†’æŒ‡æ•°"æç¤ºï¼Œè®©ç”¨æˆ·ç†è§£è¯„åˆ†è§„åˆ™
